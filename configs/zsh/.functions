
function vimz() {
  vim "$(rg --files --hidden --follow -g '!{node_modules,.git,.bare}' $1 | fzf)"
 }

kill_docker_port() {
  local port="$1"

  if [ -z "$port" ]; then
    echo "Error: Please provide a port number as an argument."
    return 1
  fi

  # Check if the port is a valid integer
  if ! [[ "$port" =~ ^[0-9]+$ ]]; then
    echo "Error: Port number must be an integer."
    return 1
  fi

  # Find containers using the specified port
  containers=$(docker ps -q --filter "port=$port")

  if [ -z "$containers" ]; then
    echo "No containers are currently using port $port."
    return 0
  fi

  # Kill the containers
  echo "Killing containers using port $port..."
  docker kill $containers
  echo "Containers using port $port have been killed."
}

function kill_port() {
    local port=$1
    if [ -z "$port" ]; then
        echo "Usage: kill_port <port_number>"
        return 1
    fi

    local pids=$(lsof -ti TCP:$port)
    if [ -z "$pids" ]; then
        echo "No process found on port $port."
        return 0
    fi

    echo "Killing processes on port $port: $pids"
    # Kill all PIDs at once (parent will terminate children)
    echo "$pids" | xargs kill -TERM 2>/dev/null

    sleep 1

    # Force kill any remaining
    pids=$(lsof -ti TCP:$port)
    if [ -n "$pids" ]; then
        echo "Force killing: $pids"
        echo "$pids" | xargs kill -9 2>/dev/null
    fi

    echo "Done."
}

function clone_worktree()  {
# clone the git repo into a bare repo and setup the directory structure
		REPO_NAME=$(echo "$1" | awk -F "[./]" '{print $(NF-1)}')
		mkdir $REPO_NAME
		git clone --bare $1 $REPO_NAME/.bare/
		echo "gitdir: ./.bare" > $REPO_NAME/.git
    cd $REPO_NAME
}

function cdf() {
  cd $(find ~/work/focaldata ~/work ~/work2 ~/work3 ~/projects ~/ -mindepth 1 -maxdepth 1 -type d 2>/dev/null | fzf)
}

function activate_venv() {
	if [ ! -d "./.venv" ]; then \
		conda create --prefix ./.venv python=3.12; \
	fi
	conda activate ./.venv
}

# OpenCode wrapper function
# Usage: oc [message] - if no message, prompts interactively
function oc() {
    local model="anthropic/claude-opus-4-5"  # default model
    
    if [ $# -eq 0 ]; then
        echo -n "Message: "
        read -r message
        opencode run -m "$model" "$message"
    else
        opencode run -m "$model" "$*"
    fi
}

# Fuzzy find directories excluding .git
function fzd() {
    find . -type d -not -path "./.git/*" -not -path "./.git" | fzf
}

# Change the current working directory when exiting Yazi.
function y() {
	local tmp="$(mktemp -t "yazi-cwd.XXXXXX")" cwd
	yazi "$@" --cwd-file="$tmp"
	IFS= read -r -d '' cwd < "$tmp"
	[ -n "$cwd" ] && [ "$cwd" != "$PWD" ] && builtin cd -- "$cwd"
	rm -f -- "$tmp"
}

# macOS only
# Open the current directory in a Ghostty Window
function ghost() {
  local dir="${1:-$PWD}"
  osascript <<EOF
    tell application "Ghostty"
      activate
      if it is running then
        tell application "System Events"
          keystroke "t" using {command down}
          delay 0.3
          keystroke "cd ${dir}"
          keystroke return
        end tell
      end if
    end tell
EOF
}

